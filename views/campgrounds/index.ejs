<% layout('layouts/boilerplate')%>

    <div class="mb-5">
        <div id="map" style="width: 100%; height: 400px; border-radius: 1rem;"></div>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="fw-bold mb-0" style="letter-spacing: -0.02em;">All Campgrounds</h1>
        <a href="/campgrounds/new" class="btn btn-apple">Add New</a>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-5">
        <% for (let campground of campgrounds){ %>
            <div class="col">
                <div class="card h-100">
                    <img src="<%=campground.images.length ? campground.images[0].url : 'https://via.placeholder.com/400x250' %>"
                        class="card-img-top" alt="<%=campground.title%>" style="height: 200px; object-fit: cover;">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title fw-semibold">
                            <%= campground.title %>
                        </h5>
                        <p class="card-text text-body-secondary small flex-grow-1">
                            <%= campground.description.substring(0, 100) %>
                                <%= campground.description.length> 100 ? '...' : '' %>
                        </p>
                        <div class="d-flex justify-content-between align-items-center mt-3 gap-2">
                            <small class="text-body-secondary text-truncate">
                                <%= campground.location %>
                            </small>
                            <a href="/campgrounds/<%=campground._id%>"
                                class="btn btn-apple btn-apple-sm flex-shrink-0">View</a>
                        </div>
                    </div>
                </div>
            </div>
            <% } %>
    </div>

    <%- "<script>" %>
        const maptilerApiKey = "<%- process.env.MAPTILER_API_KEY %>";
            const campgrounds = {
            type: "FeatureCollection",
            features: <%- JSON.stringify( campgrounds.map(campground=> ({
                type: "Feature",
                geometry: campground.geometry,
                properties: { popUpMarkup: campground?.properties?.popUpMarkup }
                }))
                ) %>
                };
                <%- "</script>" %>
                    <script src="/javascripts/clusterMap.js"></script>